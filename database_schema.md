## User Table Schema

This document outlines the schema for the `Users` table in the cloud database.

**Table Name:** `Users`

**Fields:**

| Field Name    | Data Type | Description                                   | Required | Primary Key | Notes                                             |
|---------------|-----------|-----------------------------------------------|----------|-------------|---------------------------------------------------|
| `userId`      | String    | Unique identifier for the user (auto-generated) | Yes      | Yes         |                                                   |
| `openId`      | String    | User's OpenID from WeChat                     | Yes      |             | Unique to each user within the mini-program       |
| `nickname`    | String    | User's nickname                               | No       |             | Can be updated by the user                        |
| `avatarUrl`   | String    | URL of the user's avatar                      | No       |             | Can be updated by the user                        |
| `createdAt`   | Timestamp | Timestamp of when the user record was created | Yes      |             | Automatically set by the database                 |
| `updatedAt`   | Timestamp | Timestamp of when the user record was last updated | Yes      |             | Automatically updated on modification             |
| `lastLoginAt` | Timestamp | Timestamp of the user's last login            | No       |             | Updated each time the user logs in                |
| `neighborhoodCreditScore` | Number    | User's credit score within the neighborhood | No       |             | Defaults to 100, updated by system                |

**Indexes:**

*   `openId`: To quickly find users by their WeChat OpenID.

**Example Data:**

```json
{
  "userId": "user_abc123xyz",
  "openId": "openid_qwertyuiopasdfghjkl",
  "nickname": "示例用户",
  "avatarUrl": "https://example.com/avatar.jpg",
  "createdAt": "2023-10-27T10:00:00Z",
  "updatedAt": "2023-10-27T10:05:00Z",
  "lastLoginAt": "2023-10-28T09:15:00Z",
  "neighborhoodCreditScore": 100
}
```

**Notes:**

*   The `userId` can be generated by the cloud database's auto-ID feature.
*   `openId` is crucial for linking the mini-program user with their WeChat account.
*   `nickname` and `avatarUrl` are initially fetched from WeChat but users might be allowed to change them later, depending on the application's features.
*   Timestamps are important for tracking user activity and data management.

This schema provides a basic structure for user management. Depending on future requirements, more fields can be added (e.g., phone number, preferences, etc.).

---

## UserProfileDetails Table Schema

This document outlines the schema for the `UserProfileDetails` table in the cloud database, designed to store additional information about a user's profile completeness.

**Table Name:** `UserProfileDetails`

**Fields:**

| Field Name                | Data Type | Description                                      | Required | Primary Key | Foreign Key | Notes                                                     |
|---------------------------|-----------|--------------------------------------------------|----------|-------------|-------------|-----------------------------------------------------------|
| `profileDetailId`         | String    | Unique identifier for the profile detail record (auto-generated) | Yes      | Yes         |             |                                                           |
| `userId`                  | String    | Foreign key linking to the `Users` table         | Yes      |             | `Users.userId` | Establishes a one-to-one relationship with the Users table. |
| `profileCompletionPercentage` | Number    | Percentage of profile completion (0-100)         | Yes      |             |             | Calculated based on various profile fields being set.     |
| `isBioSet`                | Boolean   | True if the user has set their biography/description | Yes      |             |             | Defaults to false.                                        |
| `isInterestsSet`          | Boolean   | True if the user has set their interests         | Yes      |             |             | Defaults to false.                                        |
| `isAddressSet`            | Boolean   | True if the user has set their address (privacy considerations) | Yes      |             |             | Defaults to false. Consider if this is truly needed or how it's handled. |
| `createdAt`               | Timestamp | Timestamp of when the record was created         | Yes      |             |             | Automatically set by the database                         |
| `updatedAt`               | Timestamp | Timestamp of when the record was last updated    | Yes      |             |             | Automatically updated on modification                     |

**Indexes:**

*   `userId`: To quickly retrieve profile details for a given user.

**Example Data:**

```json
{
  "profileDetailId": "detail_abc123xyz",
  "userId": "user_abc123xyz",
  "profileCompletionPercentage": 60,
  "isBioSet": true,
  "isInterestsSet": true,
  "isAddressSet": false,
  "createdAt": "2023-10-27T10:00:00Z",
  "updatedAt": "2023-10-27T10:10:00Z"
}
```

**Notes:**

*   This table holds supplementary user profile information, focusing on completeness.
*   `profileCompletionPercentage` can be calculated by a cloud function whenever related profile fields are updated.
*   For `isAddressSet`, careful consideration of privacy and data security is essential. It might be better to infer address completion from other non-sensitive indicators or make it optional and clearly explained.

---

## Groups Table Schema

**Table Name:** `Groups`

**Fields:**

| Field Name         | Data Type | Description                                      | Required | Primary Key | Foreign Key | Notes                               |
|--------------------|-----------|--------------------------------------------------|----------|-------------|-------------|-------------------------------------|
| `groupId`          | String    | Unique identifier for the group (auto-generated) | Yes      | Yes         |             |                                     |
| `groupName`        | String    | Name of the community group                      | Yes      |             |             |                                     |
| `groupDescription` | String    | Brief description of the group's purpose         | Yes      |             |             |                                     |
| `creatorUserId`    | String    | `userId` of the user who created the group       | Yes      |             | `Users.userId` |                                     |
| `createdAt`        | Timestamp | Timestamp of when the group was created          | Yes      |             |             | Automatically set by the database   |
| `updatedAt`        | Timestamp | Timestamp of when the group was last updated     | Yes      |             |             | Automatically updated on modification |

**Indexes:**

*   `creatorUserId`: To list groups created by a specific user.

---

## GroupMembers Table Schema

**Table Name:** `GroupMembers` (Junction Table)

**Fields:**

| Field Name     | Data Type | Description                                      | Required | Primary Key | Foreign Key      | Notes                                                        |
|----------------|-----------|--------------------------------------------------|----------|-------------|------------------|--------------------------------------------------------------|
| `membershipId` | String    | Unique identifier for the membership (auto-generated) | Yes      | Yes         |                  |                                                              |
| `groupId`      | String    | Foreign key linking to the `Groups` table        | Yes      |             | `Groups.groupId` | Part of a composite key with `userId` for uniqueness if needed |
| `userId`       | String    | Foreign key linking to the `Users` table         | Yes      |             | `Users.userId`   |                                                              |
| `joinedAt`     | Timestamp | Timestamp of when the user joined the group      | Yes      |             |                  | Automatically set by the database                            |

**Indexes:**

*   `groupId`: To list all members of a group.
*   `userId`: To list all groups a user is a member of.
*   Composite index on (`groupId`, `userId`): To ensure a user can join a group only once.

---

## Posts Table Schema

**Table Name:** `Posts`

**Fields:**

| Field Name  | Data Type | Description                                      | Required | Primary Key | Foreign Key      | Notes                                     |
|-------------|-----------|--------------------------------------------------|----------|-------------|------------------|-------------------------------------------|
| `postId`    | String    | Unique identifier for the post (auto-generated)  | Yes      | Yes         |                  |                                           |
| `groupId`   | String    | Foreign key linking to the `Groups` table        | Yes      |             | `Groups.groupId` | The group this post belongs to            |
| `userId`    | String    | Foreign key linking to the `Users` table         | Yes      |             | `Users.userId`   | The user who created the post             |
| `content`   | String    | Text content of the post                         | Yes      |             |                  |                                           |
| `imageUrls` | Array     | List of URLs for images attached to the post     | No       |             |                  | Optional, store image URLs (e.g., from cloud storage) |
| `createdAt` | Timestamp | Timestamp of when the post was created           | Yes      |             |                  | Automatically set by the database         |
| `updatedAt` | Timestamp | Timestamp of when the post was last updated      | Yes      |             |                  | Automatically updated on modification   |

**Indexes:**

*   `groupId`: To list all posts within a specific group.
*   `userId`: To list all posts made by a specific user.

---

## Comments Table Schema

**Table Name:** `Comments`

**Fields:**

| Field Name  | Data Type | Description                                         | Required | Primary Key | Foreign Key     | Notes                                   |
|-------------|-----------|-----------------------------------------------------|----------|-------------|-----------------|-----------------------------------------|
| `commentId` | String    | Unique identifier for the comment (auto-generated)  | Yes      | Yes         |                 |                                         |
| `postId`    | String    | Foreign key linking to the `Posts` table            | Yes      |             | `Posts.postId`  | The post this comment belongs to        |
| `userId`    | String    | Foreign key linking to the `Users` table            | Yes      |             | `Users.userId`  | The user who wrote the comment          |
| `content`   | String    | Text content of the comment                           | Yes      |             |                 |                                         |
| `createdAt` | Timestamp | Timestamp of when the comment was created           | Yes      |             |                 | Automatically set by the database       |
| `updatedAt` | Timestamp | Timestamp of when the comment was last updated      | Yes      |             |                 | Automatically updated on modification |

**Indexes:**

*   `postId`: To list all comments for a specific post.
*   `userId`: To list all comments made by a specific user.

---

## TrustActivityLog Table Schema

**Table Name:** `TrustActivityLog`

**Fields:**

| Field Name     | Data Type | Description                                       | Required | Primary Key | Foreign Key    | Notes                                                        |
|----------------|-----------|---------------------------------------------------|----------|-------------|----------------|--------------------------------------------------------------|
| `logId`        | String    | Unique identifier for the log entry (auto-generated) | Yes      | Yes         |                |                                                              |
| `userId`       | String    | Foreign key linking to the `Users` table          | Yes      |             | `Users.userId` | The user whose trust score is affected.                        |
| `activityType` | String    | Type of activity affecting the score              | Yes      |             |                | e.g., 'PROFILE_COMPLETE', 'COMMUNITY_POST', 'EVENT_PARTICIPATE', 'GROUP_BUY_SUCCESS', 'REPORT_VALIDATED', 'NEIGHBOR_HELP' |
| `pointsChange` | Number    | The change in points (e.g., +5, -2)               | Yes      |             |                |                                                              |
| `description`  | String    | Brief description of the activity                 | Yes      |             |                | e.g., "Completed profile setup", "Posted in 'Weekend Sports Club'" |
| `relatedId`    | String    | Optional ID related to the activity (e.g. postId, groupId, eventId) | No       |             |                | For linking back to the source of the activity               |
| `timestamp`    | Timestamp | Timestamp of when the activity occurred           | Yes      |             |                | Automatically set by the database                            |

**Indexes:**

*   `userId`: To list all trust activities for a specific user, usually sorted by `timestamp`.
*   `activityType`: To analyze types of trust activities.

**Example Data:**

```json
{
  "logId": "log_abc123xyz",
  "userId": "user_abc123xyz",
  "activityType": "PROFILE_COMPLETE",
  "pointsChange": 10,
  "description": "Achieved 80% profile completion.",
  "relatedId": "detail_abc123xyz", // Could be UserProfileDetails ID
  "timestamp": "2023-10-29T10:00:00Z"
}
```

**Notes:**

*   This table serves as an audit trail for all changes to a user's `neighborhoodCreditScore`.
*   `activityType` should be an enumerable list of predefined strings for consistency.
*   `description` provides human-readable context.
*   `relatedId` can be useful for deeper analysis or linking to specific content that caused the score change.

---

## GroupBuys Table Schema

**Table Name:** `GroupBuys`

**Fields:**

| Field Name        | Data Type | Description                                     | Required | Primary Key | Foreign Key    | Notes                                                        |
|-------------------|-----------|-------------------------------------------------|----------|-------------|----------------|--------------------------------------------------------------|
| `groupBuyId`      | String    | Unique identifier for the group buy (auto-generated) | Yes      | Yes         |                |                                                              |
| `title`           | String    | Title of the group buy                          | Yes      |             |                | e.g., "Fresh Organic Apples - Bulk Order"                    |
| `description`     | String    | Detailed description of the product/service     | Yes      |             |                |                                                              |
| `initiatorUserId` | String    | `userId` of the user who initiated the group buy | Yes      |             | `Users.userId` |                                                              |
| `productDetails`  | Object    | Details of the product                          | Yes      |             |                | e.g., `{ name: "Organic Fuji Apples", price: 2.5 (per kg), unit: "kg", imageUrl: "url_to_image.jpg" }` |
| `minParticipants` | Number    | Minimum number of participants needed           | Yes      |             |                |                                                              |
| `maxParticipants` | Number    | Maximum number of participants allowed (optional) | No       |             |                |                                                              |
| `endTime`         | Timestamp | Deadline for joining the group buy              | Yes      |             |                |                                                              |
| `status`          | String    | Current status of the group buy                 | Yes      |             |                | e.g., 'active', 'awaiting_payment', 'completed', 'cancelled', 'failed' |
| `createdAt`       | Timestamp | Timestamp of when the group buy was created     | Yes      |             |                | Automatically set by the database                            |
| `updatedAt`       | Timestamp | Timestamp of when the group buy was last updated  | Yes      |             |                | Automatically updated on modification                        |

**Indexes:**

*   `initiatorUserId`: To list group buys initiated by a specific user.
*   `status`: To quickly query group buys by their current status (e.g., all 'active' ones).
*   `endTime`: To find group buys ending soon.

---

## GroupBuyParticipants Table Schema

**Table Name:** `GroupBuyParticipants`

**Fields:**

| Field Name      | Data Type | Description                                       | Required | Primary Key | Foreign Key         | Notes                                                        |
|-----------------|-----------|---------------------------------------------------|----------|-------------|---------------------|--------------------------------------------------------------|
| `participationId`| String    | Unique identifier for the participation (auto-generated) | Yes      | Yes         |                     |                                                              |
| `groupBuyId`    | String    | Foreign key linking to the `GroupBuys` table      | Yes      |             | `GroupBuys.groupBuyId` |                                                              |
| `userId`        | String    | Foreign key linking to the `Users` table          | Yes      |             | `Users.userId`      | The user who joined                                          |
| `quantity`      | Number    | Quantity of the product the user wants to buy     | Yes      |             |                     | Defaults to 1                                                |
| `joinTime`      | Timestamp | Timestamp of when the user joined the group buy   | Yes      |             |                     | Automatically set by the database                            |
| `status`        | String    | Status of the participant's involvement           | Yes      |             |                     | e.g., 'joined', 'paid', 'payment_failed', 'collected', 'cancelled_by_user' |

**Indexes:**

*   `groupBuyId`: To list all participants for a specific group buy.
*   `userId`: To list all group buys a user has participated in.
*   Composite index on (`groupBuyId`, `userId`): To ensure a user joins a specific group buy only once with a single active participation entry (they might cancel and rejoin, which would be a new entry or an update).

---

## Services Table Schema

**Table Name:** `Services`

**Fields:**

| Field Name       | Data Type | Description                                       | Required | Primary Key | Foreign Key    | Notes                                                        |
|------------------|-----------|---------------------------------------------------|----------|-------------|----------------|--------------------------------------------------------------|
| `serviceId`      | String    | Unique identifier for the service (auto-generated)| Yes      | Yes         |                |                                                              |
| `providerUserId` | String    | `userId` of the user offering the service         | Yes      |             | `Users.userId` |                                                              |
| `title`          | String    | Title of the service offering                     | Yes      |             |                | e.g., "Weekend Lawn Mowing", "Math Tutoring (Grades 5-8)"  |
| `description`    | String    | Detailed description of the service               | Yes      |             |                |                                                              |
| `category`       | String    | Category of the service                           | Yes      |             |                | e.g., 'Home & Garden', 'Tutoring & Lessons', 'Pet Care', 'Tech Support', 'Manual Labor', 'Beauty & Wellness', 'Event Help' |
| `price`          | String    | Pricing details (e.g., "20/hour", "Free", "Barter for baked goods") | Yes      |             |                |                                                              |
| `availability`   | String    | When the service is typically available           | Yes      |             |                | e.g., "Weekends", "Evenings after 6 PM", "Flexible"          |
| `status`         | String    | Current status of the service offering            | Yes      |             |                | e.g., 'active', 'inactive', 'paused'                       |
| `createdAt`      | Timestamp | Timestamp of when the service was created         | Yes      |             |                | Automatically set by the database                            |
| `updatedAt`      | Timestamp | Timestamp of when the service was last updated    | Yes      |             |                | Automatically updated on modification                        |

**Indexes:**

*   `providerUserId`: To list services offered by a specific user.
*   `category`: To browse services by category.
*   `status`: To query active services.

---

## ServiceRequests Table Schema

**Table Name:** `ServiceRequests`

**Fields:**

| Field Name       | Data Type | Description                                       | Required | Primary Key | Foreign Key         | Notes                                                        |
|------------------|-----------|---------------------------------------------------|----------|-------------|---------------------|--------------------------------------------------------------|
| `requestId`      | String    | Unique identifier for the service request (auto-generated) | Yes      | Yes         |                     |                                                              |
| `serviceId`      | String    | Foreign key linking to the `Services` table       | Yes      |             | `Services.serviceId`|                                                              |
| `requesterUserId`| String    | `userId` of the user requesting the service       | Yes      |             | `Users.userId`      |                                                              |
| `providerUserId` | String    | `userId` of the service provider (denormalized for easier queries) | Yes      |             | `Users.userId`      |                                                              |
| `requestDetails` | String    | Specific details or message from the requester    | No       |             |                     | e.g., "Need lawn mowed this Saturday.", "My son needs help with algebra." |
| `preferredTime`  | String    | Requester's preferred time/date for the service   | No       |             |                     |                                                              |
| `status`         | String    | Current status of the service request             | Yes      |             |                     | e.g., 'pending_approval', 'accepted', 'in_progress', 'completed_by_provider', 'confirmed_by_requester', 'cancelled_by_requester', 'cancelled_by_provider', 'disputed' |
| `createdAt`      | Timestamp | Timestamp of when the request was made            | Yes      |             |                     | Automatically set by the database                            |
| `agreedDateTime` | Timestamp | The agreed date and time for service delivery     | No       |             |                     | Set after provider accepts                                   |
| `completionDate` | Timestamp | Timestamp of when the service was marked as complete by both parties | No       |             |                     |                                                              |
| `providerFeedback`| String   | Feedback from provider on the requester/service experience | No       |             |                     |                                                              |
| `requesterFeedback`| String   | Feedback from requester on the service quality    | No       |             |                     |                                                              |


**Indexes:**

*   `serviceId`: To list all requests for a specific service.
*   `requesterUserId`: To list all services requested by a user.
*   `providerUserId`: To list all service requests directed to a provider.
*   `status`: To query requests by their current status.

---

## Announcements Table Schema

**Table Name:** `Announcements`

**Fields:**

| Field Name      | Data Type | Description                                       | Required | Primary Key | Notes                                                        |
|-----------------|-----------|---------------------------------------------------|----------|-------------|--------------------------------------------------------------|
| `announcementId`| String    | Unique identifier for the announcement (auto-generated) | Yes      | Yes         |                                                              |
| `title`         | String    | Title of the announcement                         | Yes      |             |                                                              |
| `content`       | String    | Full content of the announcement                  | Yes      |             | Can include rich text or markdown if supported by frontend   |
| `author`        | String    | Author of the announcement                        | Yes      |             | e.g., 'Admin', '物业管理处', '社区委员会'                |
| `type`          | String    | Type of announcement (optional for filtering)     | No       |             | e.g., 'Event', 'Maintenance', 'General', 'Warning'       |
| `imageUrl`      | String    | Optional image URL for the announcement           | No       |             |                                                              |
| `createdAt`     | Timestamp | Timestamp of when the announcement was published  | Yes      |             | Automatically set by the database, used for sorting        |
| `expiresAt`     | Timestamp | Optional timestamp for when the announcement is no longer relevant | No       |             |                                                              |

**Indexes:**

*   `createdAt`: To sort announcements by publication date (most recent first).
*   `type`: To filter announcements by type.
*   `expiresAt`: To help in querying active/relevant announcements.

---

## UserEndorsements Table Schema

**Table Name:** `UserEndorsements`

**Fields:**

| Field Name        | Data Type | Description                                       | Required | Primary Key | Foreign Key (Table.Field) | Notes                                                        |
|-------------------|-----------|---------------------------------------------------|----------|-------------|---------------------------|--------------------------------------------------------------|
| `endorsementId`   | String    | Unique identifier for the endorsement (auto-generated) | Yes      | Yes         |                           |                                                              |
| `endorserUserId`  | String    | `userId` of the user giving the endorsement       | Yes      |             | `Users.userId`            |                                                              |
| `endorseeUserId`  | String    | `userId` of the user receiving the endorsement    | Yes      |             | `Users.userId`            |                                                              |
| `endorsementType` | String    | Type of endorsement                               | Yes      |             |                           | e.g., 'RELIABLE_GROUP_BUYER', 'HELPFUL_NEIGHBOR', 'SKILLED_SERVICE_PROVIDER', 'TRUSTWORTHY_CONTACT' |
| `comment`         | String    | Optional text comment with the endorsement        | No       |             |                           | Max 200 characters                                           |
| `createdAt`       | Timestamp | Timestamp of when the endorsement was given       | Yes      |             |                           | Automatically set by the database                            |

**Indexes:**

*   `endorseeUserId`: To list all endorsements received by a user.
*   `endorserUserId`: To list all endorsements given by a user.
*   Composite index on (`endorserUserId`, `endorseeUserId`, `endorsementType`): To prevent duplicate endorsements of the same type from the same user.

---

## Disputes Table Schema

**Table Name:** `Disputes`

**Fields:**

| Field Name           | Data Type | Description                                       | Required | Primary Key | Foreign Key (Table.Field) | Notes                                                        |
|----------------------|-----------|---------------------------------------------------|----------|-------------|---------------------------|--------------------------------------------------------------|
| `disputeId`          | String    | Unique identifier for the dispute (auto-generated)| Yes      | Yes         |                           |                                                              |
| `reporterUserId`     | String    | `userId` of the user reporting the issue          | Yes      |             | `Users.userId`            |                                                              |
| `reportedUserId`     | String    | `userId` of the user being reported (optional, if the issue is about an item not a user) | No       |             | `Users.userId`            |                                                              |
| `relatedItemId`      | String    | ID of the item related to the dispute             | Yes      |             |                           | e.g., `groupBuyId`, `serviceRequestId`, `postId`, `commentId` |
| `itemType`           | String    | Type of the related item                          | Yes      |             |                           | e.g., 'GROUP_BUY', 'SERVICE_REQUEST', 'POST', 'COMMENT'      |
| `reason`             | String    | Predefined reason for the dispute                 | Yes      |             |                           | e.g., 'ITEM_NOT_AS_DESCRIBED', 'SERVICE_NOT_RENDERED', 'NON_PAYMENT', 'HARASSMENT', 'SPAM' |
| `details`            | String    | Detailed description of the issue                 | Yes      |             |                           |                                                              |
| `status`             | String    | Current status of the dispute                     | Yes      |             |                           | e.g., 'OPEN', 'UNDER_REVIEW', 'AWAITING_USER_RESPONSE', 'RESOLVED_FAVOR_REPORTER', 'RESOLVED_FAVOR_REPORTED', 'CLOSED_INVALID', 'CLOSED_WITHDRAWN' |
| `resolutionComments` | String    | Comments from admin or mediator during resolution | No       |             |                           |                                                              |
| `createdAt`          | Timestamp | Timestamp of when the dispute was filed           | Yes      |             |                           | Automatically set by the database                            |
| `resolvedAt`         | Timestamp | Timestamp of when the dispute was resolved/closed | No       |             |                           |                                                              |

**Indexes:**

*   `reporterUserId`: To list disputes filed by a user.
*   `reportedUserId`: To list disputes against a user.
*   `status`: To query disputes by their current status.
*   `relatedItemId`, `itemType`: To find disputes related to a specific item.
