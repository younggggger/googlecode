## User Table Schema

This document outlines the schema for the `Users` table in the cloud database.

**Table Name:** `Users`

**Fields:**

| Field Name    | Data Type | Description                                   | Required | Primary Key | Notes                                             |
|---------------|-----------|-----------------------------------------------|----------|-------------|---------------------------------------------------|
| `userId`      | String    | Unique identifier for the user (auto-generated) | Yes      | Yes         |                                                   |
| `openId`      | String    | User's OpenID from WeChat                     | Yes      |             | Unique to each user within the mini-program       |
| `nickname`    | String    | User's nickname                               | No       |             | Can be updated by the user                        |
| `avatarUrl`   | String    | URL of the user's avatar                      | No       |             | Can be updated by the user                        |
| `createdAt`   | Timestamp | Timestamp of when the user record was created | Yes      |             | Automatically set by the database                 |
| `updatedAt`   | Timestamp | Timestamp of when the user record was last updated | Yes      |             | Automatically updated on modification             |
| `lastLoginAt` | Timestamp | Timestamp of the user's last login            | No       |             | Updated each time the user logs in                |
| `neighborhoodCreditScore` | Number    | User's credit score within the neighborhood | No       |             | Defaults to 100, updated by system                |

**Indexes:**

*   `openId`: To quickly find users by their WeChat OpenID.

**Example Data:**

```json
{
  "userId": "user_abc123xyz",
  "openId": "openid_qwertyuiopasdfghjkl",
  "nickname": "示例用户",
  "avatarUrl": "https://example.com/avatar.jpg",
  "createdAt": "2023-10-27T10:00:00Z",
  "updatedAt": "2023-10-27T10:05:00Z",
  "lastLoginAt": "2023-10-28T09:15:00Z",
  "neighborhoodCreditScore": 100
}
```

**Notes:**

*   The `userId` can be generated by the cloud database's auto-ID feature.
*   `openId` is crucial for linking the mini-program user with their WeChat account.
*   `nickname` and `avatarUrl` are initially fetched from WeChat but users might be allowed to change them later, depending on the application's features.
*   Timestamps are important for tracking user activity and data management.

This schema provides a basic structure for user management. Depending on future requirements, more fields can be added (e.g., phone number, preferences, etc.).

---

## UserProfileDetails Table Schema

This document outlines the schema for the `UserProfileDetails` table in the cloud database, designed to store additional information about a user's profile completeness.

**Table Name:** `UserProfileDetails`

**Fields:**

| Field Name                | Data Type | Description                                      | Required | Primary Key | Foreign Key | Notes                                                     |
|---------------------------|-----------|--------------------------------------------------|----------|-------------|-------------|-----------------------------------------------------------|
| `profileDetailId`         | String    | Unique identifier for the profile detail record (auto-generated) | Yes      | Yes         |             |                                                           |
| `userId`                  | String    | Foreign key linking to the `Users` table         | Yes      |             | `Users.userId` | Establishes a one-to-one relationship with the Users table. |
| `profileCompletionPercentage` | Number    | Percentage of profile completion (0-100)         | Yes      |             |             | Calculated based on various profile fields being set.     |
| `isBioSet`                | Boolean   | True if the user has set their biography/description | Yes      |             |             | Defaults to false.                                        |
| `isInterestsSet`          | Boolean   | True if the user has set their interests         | Yes      |             |             | Defaults to false.                                        |
| `isAddressSet`            | Boolean   | True if the user has set their address (privacy considerations) | Yes      |             |             | Defaults to false. Consider if this is truly needed or how it's handled. |
| `createdAt`               | Timestamp | Timestamp of when the record was created         | Yes      |             |             | Automatically set by the database                         |
| `updatedAt`               | Timestamp | Timestamp of when the record was last updated    | Yes      |             |             | Automatically updated on modification                     |

**Indexes:**

*   `userId`: To quickly retrieve profile details for a given user.

**Example Data:**

```json
{
  "profileDetailId": "detail_abc123xyz",
  "userId": "user_abc123xyz",
  "profileCompletionPercentage": 60,
  "isBioSet": true,
  "isInterestsSet": true,
  "isAddressSet": false,
  "createdAt": "2023-10-27T10:00:00Z",
  "updatedAt": "2023-10-27T10:10:00Z"
}
```

**Notes:**

*   This table holds supplementary user profile information, focusing on completeness.
*   `profileCompletionPercentage` can be calculated by a cloud function whenever related profile fields are updated.
*   For `isAddressSet`, careful consideration of privacy and data security is essential. It might be better to infer address completion from other non-sensitive indicators or make it optional and clearly explained.

---

## Groups Table Schema

**Table Name:** `Groups`

**Fields:**

| Field Name         | Data Type | Description                                      | Required | Primary Key | Foreign Key | Notes                               |
|--------------------|-----------|--------------------------------------------------|----------|-------------|-------------|-------------------------------------|
| `groupId`          | String    | Unique identifier for the group (auto-generated) | Yes      | Yes         |             |                                     |
| `groupName`        | String    | Name of the community group                      | Yes      |             |             |                                     |
| `groupDescription` | String    | Brief description of the group's purpose         | Yes      |             |             |                                     |
| `creatorUserId`    | String    | `userId` of the user who created the group       | Yes      |             | `Users.userId` |                                     |
| `createdAt`        | Timestamp | Timestamp of when the group was created          | Yes      |             |             | Automatically set by the database   |
| `updatedAt`        | Timestamp | Timestamp of when the group was last updated     | Yes      |             |             | Automatically updated on modification |

**Indexes:**

*   `creatorUserId`: To list groups created by a specific user.

---

## GroupMembers Table Schema

**Table Name:** `GroupMembers` (Junction Table)

**Fields:**

| Field Name     | Data Type | Description                                      | Required | Primary Key | Foreign Key      | Notes                                                        |
|----------------|-----------|--------------------------------------------------|----------|-------------|------------------|--------------------------------------------------------------|
| `membershipId` | String    | Unique identifier for the membership (auto-generated) | Yes      | Yes         |                  |                                                              |
| `groupId`      | String    | Foreign key linking to the `Groups` table        | Yes      |             | `Groups.groupId` | Part of a composite key with `userId` for uniqueness if needed |
| `userId`       | String    | Foreign key linking to the `Users` table         | Yes      |             | `Users.userId`   |                                                              |
| `joinedAt`     | Timestamp | Timestamp of when the user joined the group      | Yes      |             |                  | Automatically set by the database                            |

**Indexes:**

*   `groupId`: To list all members of a group.
*   `userId`: To list all groups a user is a member of.
*   Composite index on (`groupId`, `userId`): To ensure a user can join a group only once.

---

## Posts Table Schema

**Table Name:** `Posts`

**Fields:**

| Field Name  | Data Type | Description                                      | Required | Primary Key | Foreign Key      | Notes                                     |
|-------------|-----------|--------------------------------------------------|----------|-------------|------------------|-------------------------------------------|
| `postId`    | String    | Unique identifier for the post (auto-generated)  | Yes      | Yes         |                  |                                           |
| `groupId`   | String    | Foreign key linking to the `Groups` table        | Yes      |             | `Groups.groupId` | The group this post belongs to            |
| `userId`    | String    | Foreign key linking to the `Users` table         | Yes      |             | `Users.userId`   | The user who created the post             |
| `content`   | String    | Text content of the post                         | Yes      |             |                  |                                           |
| `imageUrls` | Array     | List of URLs for images attached to the post     | No       |             |                  | Optional, store image URLs (e.g., from cloud storage) |
| `createdAt` | Timestamp | Timestamp of when the post was created           | Yes      |             |                  | Automatically set by the database         |
| `updatedAt` | Timestamp | Timestamp of when the post was last updated      | Yes      |             |                  | Automatically updated on modification   |

**Indexes:**

*   `groupId`: To list all posts within a specific group.
*   `userId`: To list all posts made by a specific user.

---

## Comments Table Schema

**Table Name:** `Comments`

**Fields:**

| Field Name  | Data Type | Description                                         | Required | Primary Key | Foreign Key     | Notes                                   |
|-------------|-----------|-----------------------------------------------------|----------|-------------|-----------------|-----------------------------------------|
| `commentId` | String    | Unique identifier for the comment (auto-generated)  | Yes      | Yes         |                 |                                         |
| `postId`    | String    | Foreign key linking to the `Posts` table            | Yes      |             | `Posts.postId`  | The post this comment belongs to        |
| `userId`    | String    | Foreign key linking to the `Users` table            | Yes      |             | `Users.userId`  | The user who wrote the comment          |
| `content`   | String    | Text content of the comment                           | Yes      |             |                 |                                         |
| `createdAt` | Timestamp | Timestamp of when the comment was created           | Yes      |             |                 | Automatically set by the database       |
| `updatedAt` | Timestamp | Timestamp of when the comment was last updated      | Yes      |             |                 | Automatically updated on modification |

**Indexes:**

*   `postId`: To list all comments for a specific post.
*   `userId`: To list all comments made by a specific user.

---

## TrustActivityLog Table Schema

**Table Name:** `TrustActivityLog`

**Fields:**

| Field Name     | Data Type | Description                                       | Required | Primary Key | Foreign Key    | Notes                                                        |
|----------------|-----------|---------------------------------------------------|----------|-------------|----------------|--------------------------------------------------------------|
| `logId`        | String    | Unique identifier for the log entry (auto-generated) | Yes      | Yes         |                |                                                              |
| `userId`       | String    | Foreign key linking to the `Users` table          | Yes      |             | `Users.userId` | The user whose trust score is affected.                        |
| `activityType` | String    | Type of activity affecting the score              | Yes      |             |                | e.g., 'PROFILE_COMPLETE', 'COMMUNITY_POST', 'EVENT_PARTICIPATE', 'GROUP_BUY_SUCCESS', 'REPORT_VALIDATED', 'NEIGHBOR_HELP' |
| `pointsChange` | Number    | The change in points (e.g., +5, -2)               | Yes      |             |                |                                                              |
| `description`  | String    | Brief description of the activity                 | Yes      |             |                | e.g., "Completed profile setup", "Posted in 'Weekend Sports Club'" |
| `relatedId`    | String    | Optional ID related to the activity (e.g. postId, groupId, eventId) | No       |             |                | For linking back to the source of the activity               |
| `timestamp`    | Timestamp | Timestamp of when the activity occurred           | Yes      |             |                | Automatically set by the database                            |

**Indexes:**

*   `userId`: To list all trust activities for a specific user, usually sorted by `timestamp`.
*   `activityType`: To analyze types of trust activities.

**Example Data:**

```json
{
  "logId": "log_abc123xyz",
  "userId": "user_abc123xyz",
  "activityType": "PROFILE_COMPLETE",
  "pointsChange": 10,
  "description": "Achieved 80% profile completion.",
  "relatedId": "detail_abc123xyz", // Could be UserProfileDetails ID
  "timestamp": "2023-10-29T10:00:00Z"
}
```

**Notes:**

*   This table serves as an audit trail for all changes to a user's `neighborhoodCreditScore`.
*   `activityType` should be an enumerable list of predefined strings for consistency.
*   `description` provides human-readable context.
*   `relatedId` can be useful for deeper analysis or linking to specific content that caused the score change.
